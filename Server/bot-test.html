<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>ü§ñ Bot Integration Test</title>
		<style>
			body {
				font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				margin: 0;
				padding: 20px;
			}
			.container {
				max-width: 1000px;
				margin: 0 auto;
				background: white;
				border-radius: 15px;
				padding: 30px;
				box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
			}
			h1 {
				color: #667eea;
				text-align: center;
				margin-bottom: 30px;
			}
			.upload-area {
				border: 3px dashed #667eea;
				border-radius: 10px;
				padding: 40px;
				text-align: center;
				margin-bottom: 20px;
				cursor: pointer;
			}
			.upload-area:hover {
				background-color: #f8f9fa;
			}
			.analyze-btn {
				background: linear-gradient(45deg, #667eea, #764ba2);
				color: white;
				border: none;
				padding: 15px 30px;
				border-radius: 8px;
				font-size: 16px;
				cursor: pointer;
				width: 100%;
				margin: 20px 0;
			}
			.analyze-btn:hover {
				transform: translateY(-2px);
			}
			.analyze-btn:disabled {
				background: #ccc;
				cursor: not-allowed;
			}
			.results {
				margin-top: 30px;
				display: none;
			}
			.pixel-coords {
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
				gap: 15px;
				margin: 20px 0;
			}
			.coord-box {
				background: #f8f9fa;
				padding: 15px;
				border-radius: 8px;
				border-left: 4px solid #667eea;
			}
			.coord-box h4 {
				margin: 0 0 10px 0;
				color: #333;
			}
			.coord-value {
				font-family: "Courier New", monospace;
				font-weight: bold;
				color: #667eea;
			}
			.execution-steps {
				background: #f0f8ff;
				padding: 20px;
				border-radius: 8px;
				margin: 20px 0;
			}
			.step {
				background: white;
				padding: 10px;
				margin: 5px 0;
				border-radius: 5px;
				border-left: 3px solid #667eea;
			}
			.au3-code {
				background: #2d3748;
				color: #e2e8f0;
				padding: 20px;
				border-radius: 8px;
				font-family: "Courier New", monospace;
				font-size: 14px;
				overflow-x: auto;
			}
			.image-preview {
				max-width: 300px;
				margin: 10px auto;
				display: block;
				border-radius: 8px;
			}
		</style>
	</head>
	<body>
		<div class="container">
			<h1>ü§ñ Bot Integration Test - Pixel Coordinates</h1>

			<div
				class="upload-area"
				onclick="document.getElementById('imageInput').click()"
			>
				<p>üì∏ <strong>Drop base image here or click to upload</strong></p>
				<p>Supports PNG, JPG, JPEG files</p>
				<input
					type="file"
					id="imageInput"
					accept="image/*"
					style="display: none"
				/>
				<img id="imagePreview" class="image-preview" style="display: none" />
			</div>

			<button id="analyzeBtn" class="analyze-btn" disabled>
				ü§ñ Analyze for Bot Integration
			</button>

			<div id="results" class="results">
				<h2>Bot Integration Results</h2>

				<div id="baseInfo"></div>

				<h3>üéØ Deployment Coordinates (for DropTroop.au3)</h3>
				<div id="pixelCoords" class="pixel-coords"></div>

				<h3>‚öîÔ∏è Execution Steps (for launchtroop2)</h3>
				<div id="executionSteps" class="execution-steps"></div>

				<h3>üìÑ AutoIt Code (Copy & Paste)</h3>
				<div id="au3Code" class="au3-code"></div>
			</div>
		</div>

		<script>
			const imageInput = document.getElementById("imageInput");
			const imagePreview = document.getElementById("imagePreview");
			const analyzeBtn = document.getElementById("analyzeBtn");
			const results = document.getElementById("results");

			let selectedImage = null;

			imageInput.addEventListener("change", function (e) {
				const file = e.target.files[0];
				if (file) {
					const reader = new FileReader();
					reader.onload = function (e) {
						selectedImage = e.target.result;
						imagePreview.src = selectedImage;
						imagePreview.style.display = "block";
						analyzeBtn.disabled = false;
					};
					reader.readAsDataURL(file);
				}
			});

			analyzeBtn.addEventListener("click", async function () {
				if (!selectedImage) return;

				analyzeBtn.textContent = "üîÑ Analyzing...";
				analyzeBtn.disabled = true;

				try {
					const response = await fetch("/api/bot-analyze", {
						method: "POST",
						headers: {
							"Content-Type": "application/json",
						},
						body: JSON.stringify({
							baseImage: selectedImage,
							troopComposition:
								"Giants: 4, Wall Breakers: 6, Wizards: 12, Archers: 30",
							targetResources: "Gold and Elixir priority",
						}),
					});

					const data = await response.json();

					if (data.success) {
						displayBotResults(data.botData);
						results.style.display = "block";
					} else {
						alert("Analysis failed: " + data.error);
					}
				} catch (error) {
					alert("Error: " + error.message);
				}

				analyzeBtn.textContent = "ü§ñ Analyze for Bot Integration";
				analyzeBtn.disabled = false;
			});

			function displayBotResults(botData) {
				// Base info
				document.getElementById("baseInfo").innerHTML = `
                <div class="coord-box">
                    <h4>üìä Base Information</h4>
                    <p><strong>Town Hall Level:</strong> ${botData.townHallLevel}</p>
                    <p><strong>Base Type:</strong> ${botData.baseType}</p>
                    <p><strong>Strategy:</strong> ${botData.recommendedStrategy}</p>
                    <p><strong>Attack Edge:</strong> ${botData.attackEdge.bestEdge}</p>
                </div>
            `;

				// Pixel coordinates
				const pixelCoords = document.getElementById("pixelCoords");
				pixelCoords.innerHTML = `
                <div class="coord-box">
                    <h4>üéØ Primary Deploy</h4>
                    <div class="coord-value">X: ${botData.deploymentCoordinates.primaryX}</div>
                    <div class="coord-value">Y: ${botData.deploymentCoordinates.primaryY}</div>
                </div>
                <div class="coord-box">
                    <h4>üí• Wall Breaker</h4>
                    <div class="coord-value">X: ${botData.deploymentCoordinates.wallBreakerX}</div>
                    <div class="coord-value">Y: ${botData.deploymentCoordinates.wallBreakerY}</div>
                </div>
                <div class="coord-box">
                    <h4>üè∞ Town Hall Target</h4>
                    <div class="coord-value">X: ${botData.targetPixels.townHallX}</div>
                    <div class="coord-value">Y: ${botData.targetPixels.townHallY}</div>
                </div>
                <div class="coord-box">
                    <h4>üõ°Ô∏è Tank Deploy</h4>
                    <div class="coord-value">X: ${botData.edgeDeployment.tankX}</div>
                    <div class="coord-value">Y: ${botData.edgeDeployment.tankY}</div>
                </div>
                <div class="coord-box">
                    <h4>üíä Heal Spell</h4>
                    <div class="coord-value">X: ${botData.spellPixels.healX}</div>
                    <div class="coord-value">Y: ${botData.spellPixels.healY}</div>
                </div>
                <div class="coord-box">
                    <h4>‚ö° Rage Spell</h4>
                    <div class="coord-value">X: ${botData.spellPixels.rageX}</div>
                    <div class="coord-value">Y: ${botData.spellPixels.rageY}</div>
                </div>
            `;

				// Execution steps
				const executionSteps = document.getElementById("executionSteps");
				const stepsHtml = botData.executionSteps
					.map(
						(step) => `
                <div class="step">
                    <strong>Step ${step.stepNumber}:</strong> ${step.action}
                    ${
											step.pixelX
												? `<br><small>Coordinates: X=${step.pixelX}, Y=${step.pixelY}</small>`
												: ""
										}
                </div>
            `
					)
					.join("");
				executionSteps.innerHTML = stepsHtml;

				// AutoIt code generation
				const au3Code = generateAu3Code(botData);
				document.getElementById("au3Code").innerHTML = au3Code;
			}

			function generateAu3Code(botData) {
				return `<span style="color: #68d391">; AI-Generated Attack Plan for ${botData.baseType} Base</span>
<span style="color: #68d391">; Town Hall Level: ${botData.townHallLevel}</span>
<span style="color: #68d391">; Strategy: ${botData.recommendedStrategy}</span>

<span style="color: #f6e05e">Func</span> <span style="color: #90cdf4">AIAttackPlan()</span>
    <span style="color: #68d391">; Primary deployment coordinates</span>
    <span style="color: #f6e05e">Local</span> <span style="color: #90cdf4">$primaryX</span> = <span style="color: #fbb6ce">${botData.deploymentCoordinates.primaryX}</span>
    <span style="color: #f6e05e">Local</span> <span style="color: #90cdf4">$primaryY</span> = <span style="color: #fbb6ce">${botData.deploymentCoordinates.primaryY}</span>
    
    <span style="color: #68d391">; Tank deployment</span>
    <span style="color: #90cdf4">DropTroop</span>(<span style="color: #fbb6ce">${botData.edgeDeployment.tankX}</span>, <span style="color: #fbb6ce">${botData.edgeDeployment.tankY}</span>, <span style="color: #fbb6ce">4</span>, <span style="color: #fbb6ce">"Giants"</span>)
    <span style="color: #90cdf4">Sleep</span>(<span style="color: #fbb6ce">2000</span>)
    
    <span style="color: #68d391">; Wall breakers</span>
    <span style="color: #90cdf4">DropTroop</span>(<span style="color: #fbb6ce">${botData.deploymentCoordinates.wallBreakerX}</span>, <span style="color: #fbb6ce">${botData.deploymentCoordinates.wallBreakerY}</span>, <span style="color: #fbb6ce">3</span>, <span style="color: #fbb6ce">"WallBreakers"</span>)
    <span style="color: #90cdf4">Sleep</span>(<span style="color: #fbb6ce">3000</span>)
    
    <span style="color: #68d391">; DPS troops behind tanks</span>
    <span style="color: #90cdf4">DropTroop</span>(<span style="color: #fbb6ce">${botData.edgeDeployment.dpsX}</span>, <span style="color: #fbb6ce">${botData.edgeDeployment.dpsY}</span>, <span style="color: #fbb6ce">12</span>, <span style="color: #fbb6ce">"Wizards"</span>)
    
    <span style="color: #68d391">; Wait for troops to engage, then use spells</span>
    <span style="color: #90cdf4">Sleep</span>(<span style="color: #fbb6ce">5000</span>)
    <span style="color: #90cdf4">CastSpell</span>(<span style="color: #fbb6ce">${botData.spellPixels.healX}</span>, <span style="color: #fbb6ce">${botData.spellPixels.healY}</span>, <span style="color: #fbb6ce">"Heal"</span>)
    
    <span style="color: #68d391">; Deploy heroes for final push</span>
    <span style="color: #90cdf4">Sleep</span>(<span style="color: #fbb6ce">3000</span>)
    <span style="color: #90cdf4">DropTroop</span>(<span style="color: #fbb6ce">${botData.edgeDeployment.heroX}</span>, <span style="color: #fbb6ce">${botData.edgeDeployment.heroY}</span>, <span style="color: #fbb6ce">1</span>, <span style="color: #fbb6ce">"BarbKing"</span>)
<span style="color: #f6e05e">EndFunc</span>

<span style="color: #68d391">; Call the AI attack plan</span>
<span style="color: #90cdf4">AIAttackPlan()</span>`;
			}
		</script>
	</body>
</html>
